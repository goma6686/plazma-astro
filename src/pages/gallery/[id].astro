---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Header from "@components/Header.astro";
import Layout from "@layouts/Layout.astro";
import Main from "@layouts/Main.astro";
import { SITE } from "@config";
import Footer from "@components/Footer.astro";
import { getAlbumImages } from "@utils/albums";
import Gallery from "@layouts/Gallery.astro";

export async function getStaticPaths() {
  const albums = await getCollection("albums");

  const paths = Object.values(albums).map((album) => {
    return {
      params: {
        id: album.id,
      },
      props: {
        album,
      },
    };
  });

  return paths;
}

const { album } = Astro.props;
const images = await getAlbumImages(album.id);
---
<Layout title={album.data.title}>
  <Header activeNav="gallery" />
  <Gallery pageTitle="" pageDesc="" >
    <div class="w-full px-4 sm:px-6 lg:px-8">
      <div class="max-w-7xl mx-auto text-center">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-8 mt-8">
          {album.data.title}
        </h1>
        <div class="masonry-grid">
          {
            images.map((image) => (
              <div class="masonry-item">
                <Image
                  src={image}
                  alt={`Image from ${album.data.title} album`}
                  format="avif"
                  quality={50}
                  class="w-full h-auto object-cover rounded transition-all duration-300 ease-in-out hover:scale-105 hover:shadow-lg"
                  loading="lazy"
                  data-album-image
                />
              </div>
            ))
          }
        </div>
   
        <p class="flex justify-center mb-8 mt-8">
          <button
            class="focus-outline flex hover:opacity-75"
            onclick="(() => (history.length === 1) ? window.location = '/' : history.back())()"
          >
            <svg xmlns="http://www.w3.org/2000/svg"
              ><path
                d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"
              ></path>
            </svg><span>Go back</span>
          </button>
          
        </p>
      </div>
    </div>
  </Main>
  <Footer />
</Layout>

<style>
  .masonry-grid {
    @apply gap-4;
    column-count: 1;
    column-gap: 1rem;
  }
  
  @screen lg {
    .masonry-grid {
      column-count: 2;
    }
  }
  
  .masonry-item {
    break-inside: avoid;
    margin-bottom: 1rem;
  }
</style>